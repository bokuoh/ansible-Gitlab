{"name":"Ansible-gitlab","tagline":"Gitlab by ansible","body":"ansible-Gitlab\r\n=====================\r\n\r\nansibleを使って、Gitの共有リポジトリを管理できるマシンを構築します。  \r\n以下のソフトウェアをインストールします。  \r\n\r\n[Gitlab](http://gitlab.org/)…Ruby製のGit管理サーバソフトウェア  \r\n\r\n[ansible](http://www.ansibleworks.com/)...サーバ構成管理ソフトウェア  \r\n\r\nアクセスはサブドメイン(gitlab.cadence)で行います。\r\n\r\n![ソフトウェア構成図](https://raw.github.com/volanja/ansible-Gitlab/master/img/ansible-Gitlab.png)\r\n\r\n対象環境\r\n-----\r\nCentOS 6.4 64bit   (virtualbox + vagrantで構築)\r\n\r\n実行環境\r\n-----\r\n\t$ ansible --version  \r\n\tansible 1.4.1 (1.4.1 7bf799af65) last updated 2013/11/30 14:23:28 (GMT +900)\r\n\r\n\t$ ruby -v  \r\n\truby 2.0.0p353 (2013-11-22 revision 43784) [x86_64-darwin11.4.2]\r\n\r\n\t$ gem list |grep serverspec  \r\n\tserverspec (0.13.2)\r\n\r\nインストールするもの\r\n------\r\n+ ruby 2.0.0p353 (/home/git配下にrbenvでインストール)\r\n+ git 1.7.10+\r\n+ redis 2.0+\r\n+ MariaDB 5.5.33a\r\n+ Gitlab 6.3\r\n+ Nginx\r\n\r\n実行手順\r\n----\r\n1. hostsファイルの設定変更  \r\nclone後、hostsファイル内の対象サーバのIPアドレスを変更してください。\r\n\r\n2. SSH公開鍵認証の準備  \r\n対象サーバにSSH公開鍵認証方式でログイン出来るように準備してください。\r\n\r\n3. ansible playbook 実行  \r\n対象サーバのドメイン名を次のファイルに定義(デフォルトはcadence)してください。  \r\nWindows/Linuxからはhostsファイルの書き換えにより、アクセスするようにします。\r\n```\r\n+----------------------------------------------------------------------------+\r\n|             File             |          Key          |        Value        |\r\n+----------------------------------------------------------------------------+\r\n| roles/gitlab/vars/main.yml   | server_name           | cadence             |\r\n| roles/hostname/vars/main.yml | server_name           | cadence             |\r\n+----------------------------------------------------------------------------+\r\n```\r\n次のコマンドで実行します。  \r\n```\r\n$ ansible-playbook setup.yml -i hosts  \r\n```\r\n\r\n4. テストの準備  \r\nServerspecで行います。  \r\nspec/properties.ymlのIPアドレス、秘密鍵を修正してください。\r\n```spec/spec.yml\r\nroot:\r\n  roles:\r\n    - Packages\r\n    - gitlab\r\n  ip: 192.168.0.108\r\n  private_key: ~/.ssh/id_rsa\r\n```\r\n\r\n5. テストの実行  \r\n次のコマンドで実行します。  \r\n```\r\n$ rake serverspec       # Run serverspec to all hosts\r\n```\r\n\r\n6. Gitlabへのアクセス  \r\nあらかじめhostsファイルを次のように変更しておきます。  \r\nWindows... C:/Windows/System32/drivers/etc/hosts  \r\nLinux,Mac... /etc/hosts\r\n```\r\n192.168.0.108 gitlab.cadence\r\n```\r\n次のURLでアクセスできます。  \r\n```\r\nhttp://gitlab.cadence/  \r\nID...admin@local.host  \r\nパスワード...5iveL!fe\r\n```\r\n\r\nプラグイン\r\n----\r\n[プラグイン](docs/plugins.md)\r\n\r\n謝辞\r\n-----\r\n作成にあたり、以下のサイトを参考にさせて頂きました。\r\n+ [serverspec インフラ層のテスト項目を考える](https://hiroakis.com/blog/2013/12/24/serverspec-%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E5%B1%A4%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E9%A0%85%E7%9B%AE%E3%82%92%E8%80%83%E3%81%88%E3%82%8B/)\r\n+ [gitlab 6.2簡単インストール](https://gist.github.com/hiroaki256/8142865)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}